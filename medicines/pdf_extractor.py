import json
import logging
import os
import re
import urllib.parse
from pathlib import Path
from typing import Dict, List, Optional

import fitz  # PyMuPDF

# ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

class PDFExtractor:
    def __init__(self):
        self.text = ""
        self.medicine_data = {}
    
    def clean_pdf_path(self, pdf_path: str) -> str:
        """‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î PDF path ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ"""
        original_path = pdf_path
        
        try:
            # ‡∏•‡∏ö file:// ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
            if pdf_path.startswith('file://'):
                pdf_path = pdf_path.replace('file://', '')
                logger.info(f"‡∏•‡∏ö file:// prefix")
            
            # ‡∏•‡∏ö / ‡∏´‡∏ô‡πâ‡∏≤ path ‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ Windows
            if pdf_path.startswith('/') and ':' in pdf_path:
                pdf_path = pdf_path[1:]
                logger.info(f"‡∏•‡∏ö / ‡∏´‡∏ô‡πâ‡∏≤ Windows path")
            
            # ‡πÅ‡∏õ‡∏•‡∏á URL encoding
            pdf_path = urllib.parse.unquote(pdf_path)
            logger.info(f"‡πÅ‡∏õ‡∏•‡∏á URL encoding")
            
            # ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô Path object
            path_obj = Path(pdf_path)
            if not path_obj.is_absolute():
                path_obj = path_obj.resolve()
            
            final_path = str(path_obj)
            logger.info(f"Path ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢: {final_path}")
            
            return final_path
            
        except Exception as e:
            logger.error(f"‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á path: {e}")
            logger.error(f"Path ‡πÄ‡∏î‡∏¥‡∏°: {original_path}")
            return pdf_path
    
    def extract_text_from_pdf(self, pdf_path: str) -> str:
        """‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF ‡∏î‡πâ‡∏ß‡∏¢ PyMuPDF"""
        
        try:
            # ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î path
            cleaned_path = self.clean_pdf_path(pdf_path)
            
            # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á
            if not Path(cleaned_path).exists():
                logger.error(f"‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå PDF: {cleaned_path}")
                return ""
            
            logger.info(f"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå: {cleaned_path}")
            
            # ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå PDF
            doc = fitz.open(cleaned_path)
            text = ""
            
            # ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤
            for page_num in range(len(doc)):
                page = doc.load_page(page_num)
                page_text = page.get_text()
                text += page_text
                logger.info(f"‡πÅ‡∏õ‡∏•‡∏á‡∏´‡∏ô‡πâ‡∏≤ {page_num + 1}: {len(page_text)} ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£")
            
            # ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå
            doc.close()
            
            self.text = text
            logger.info(f"‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏£‡∏ß‡∏° {len(text)} ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)")
            
            # ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå txt ‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
            txt_folder = "F:/medicApp/medicines/info_medicinestxt"
            filename = Path(cleaned_path).stem
            output_filename = os.path.join(txt_folder, f"extracted_text_{filename}.txt")
            
            # ‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
            if os.path.exists(output_filename):
                os.remove(output_filename)
                logger.info(f"‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå .txt ‡πÄ‡∏Å‡πà‡∏≤: {output_filename}")
                
            # ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà
            with open(output_filename, 'w', encoding='utf-8') as f:
                f.write(text)
            logger.info(f"‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå: {output_filename}")
            
            return text
            
        except Exception as e:
            logger.error(f"‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å PDF: {e}")
            return ""
    
    def clean_text(self, text: str) -> str:
        """‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°"""
        text = re.sub(r'\s+', ' ', text)
        text = re.sub(r'(\d+\.\d*)', r'\n\1', text)
        return text.strip()
    
    def find_section_boundaries(self, text: str) -> Dict[str, tuple]:
        """‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô"""
        boundaries = {}
        
        section_patterns = {
            '1.1': [
                r'1\.1\.?\s*‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£',
                r'1\.1\.?\s*‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£',
                r'1\.1\.?\s*‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ä‡∏≠‡∏∑‡πà‡∏ß‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£',
                r'1\.1\.?\s*‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡∏ä‡∏≠‡∏∑‡πà‡∏ß‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£',
                r'1\.1\.?\s*‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠',
                r'1\.1\.?\s*‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡∏ä‡∏∑‡πà‡∏≠'
            ],
            '1.2': [
                r'1\.2\.\s*‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏£',
                r'1\.2\.?\s*‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏£',
                r'1\.2\s*‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏£'
            ],
            '2.1': [
                r'2\.1\.\s*‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏£',
                r'2\.1\.?\s*‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏£',
                r'2\.1\s*‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏£'
            ],
            '2.2': [
                r'2\.2\.?\s*‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á\s*‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏ô‡∏µ‡πâ',
                r'2\.2\.?\s*‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á\s*‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÉ‡∏´‡πâ‡∏ö‡∏≠‡∏Å‡πÅ‡∏û‡∏ó‡∏¢‡πå',
                r'2\.2\.?\s*‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á\s*‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢',
                r'2\.2\.?\s*‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á'
            ],
            '3.1': [
                r'3\.1\.?\s*‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ',
                r'3\.1\.?\s*‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä',
                r'3\.1\.?\s*‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ',
                r'3\.1\.?\s*‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ\s*‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ï‡∏±‡∏ß',
                r'3\.1\.?\s*‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ\s*‡∏ô‡πç‡πâ‡∏≤‡∏´‡∏ô‡∏±‡∏Å‡∏ï‡∏±‡∏ß'
            ],
            '3.2': [
                r'3\.2\.?\s*‡∏ñ‡πâ‡∏≤‡∏•‡∏∑‡∏°‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£',
                r'3\.2\.?\s*‡∏ñ‡πâ‡∏≤‡∏•‡∏∑‡∏°‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡∏Ñ‡∏ß‡∏£‡∏ó‡πç‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£',
                r'3\.2\.?\s*‡∏´‡∏≤‡∏Å‡∏•‡∏∑‡∏°‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£',
                r'3\.2\.?\s*‡∏´‡∏≤‡∏Å‡∏•‡∏∑‡∏°‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡∏Ñ‡∏ß‡∏£‡∏ó‡πç‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£',
                r'3\.2\.?\s*‡∏ñ‡πâ‡∏≤‡∏•‡∏∑‡∏°‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤',
                r'3\.2\.?\s*‡∏´‡∏≤‡∏Å‡∏•‡∏∑‡∏°‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤'
            ],
            '3.3': [
                r'3\.3\.?\s*‡∏ñ‡πâ‡∏≤‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£',
                r'3\.3\.?\s*‡∏ñ‡πâ‡∏≤‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡πç‡∏≤‡∏Ñ‡∏ß‡∏£‡∏ó‡πç‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£',
                r'3\.3\.?\s*‡∏ñ‡πâ‡∏≤‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥\s*‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£',
                r'3\.3\.?\s*‡∏ñ‡πâ‡∏≤‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡πç‡∏≤\s*‡∏Ñ‡∏ß‡∏£‡∏ó‡πç‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£',
                r'3\.3\.?\s*‡∏ñ‡πâ‡∏≤‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î'
            ],
            '4.': [
                r'4\.?\s*‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏ä‡πâ‡∏¢‡∏≤',
                r'4\.?\s*‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏ä‡∏¢‡∏≤',
                r'4\.?\s*‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏ô‡∏µ‡πâ',
                r'4\.?\s*‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥',
                r'4\.?\s*‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤'
            ],
            '5.1': [
                r'5\.1\.?\s*‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏µ‡∏ö‡πÑ‡∏õ‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå',
                r'5\.1\.?\s*‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ',
                r'5\.1\.?\s*‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤',
                r'5\.1\.?\s*‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏á‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤',
                r'5\.1\.?\s*‡∏´‡∏≤‡∏Å‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏£',
                r'5\.1\.?\s*‡∏´‡∏≤‡∏Å‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏£\s*‡πÄ‡∏ä‡πà‡∏ô'
            ],
            '5.2': [
                r'5\.2\.?\s*‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤\s*‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå',
                r'5\.2\.?\s*‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡πç‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤',
                r'5\.2\.?\s*‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô',
                r'5\.2\.?\s*‡∏´‡∏≤‡∏Å‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏£',
                r'5\.2\.?\s*‡∏´‡∏≤‡∏Å‡∏à‡πç‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏£\s*‡πÄ‡∏ä‡πà‡∏ô'
            ],
            '6.': [
                r'6\.?\s*‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£',
                r'6\.?\s*‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏¢‡∏≤'
            ],
            '7.': [
                r'7\.?\s*‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏¢‡∏≤',
                r'7\.?\s*‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÅ‡∏•‡∏∞‡∏™‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏¢‡∏≤',
                r'7\.?\s*‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö',
                r'7\.?\s*‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏¢‡∏≤‡∏ô‡∏µ‡πâ'
            ]
        }
        
        for section_num, patterns in section_patterns.items():
            found = False
            for pattern in patterns:
                match = re.search(pattern, text, re.IGNORECASE)
                if match:
                    start_pos = match.end()
                    end_pos = self._find_section_end(text, section_num, start_pos, section_patterns)
                    boundaries[section_num] = (start_pos, end_pos)
                    logger.info(f"‚úÖ ‡∏û‡∏ö‡∏™‡πà‡∏ß‡∏ô {section_num}: ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á {start_pos}-{end_pos}")
                    found = True
                    break
            
            if not found:
                logger.warning(f"‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡πà‡∏ß‡∏ô {section_num}")
        
        return boundaries
    
    def _find_section_end(self, text: str, current_section: str, start_pos: int, section_patterns: Dict) -> int:
        """‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô"""
        sections_order = ['1.1', '1.2', '2.1', '2.2', '3.1', '3.2', '3.3', '4.', '5.1', '5.2', '6.', '7.']
        
        try:
            current_index = sections_order.index(current_section)
            next_sections = sections_order[current_index + 1:]
        except ValueError:
            return len(text)
        
        end_pos = len(text)
        
        for next_section in next_sections:
            if next_section in section_patterns:
                for pattern in section_patterns[next_section]:
                    next_match = re.search(pattern, text[start_pos:], re.IGNORECASE)
                    if next_match:
                        end_pos = start_pos + next_match.start()
                        return end_pos
        
        return end_pos
    
    def extract_section_content(self, text: str, start_pos: int, end_pos: int) -> str:
        """‡πÅ‡∏¢‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î"""
        content = text[start_pos:end_pos].strip()
        content = re.sub(r'\s+', ' ', content)
        
        # ‡∏ï‡∏±‡∏î‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
        section_headers = [
            r'1\.1\.?\s*‡∏¢‡∏≤‡∏ô‡∏µ‡πâ', r'1\.2\.?\s*‡∏¢‡∏≤‡∏ô‡∏µ‡πâ', r'2\.1\.?\s*‡∏´‡πâ‡∏≤‡∏°',
            r'2\.2\.?\s*‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£', r'3\.1\.?\s*‡∏Ç‡∏ô‡∏≤‡∏î', r'3\.2\.?\s*‡∏ñ‡πâ‡∏≤‡∏•‡∏∑‡∏°',
            r'3\.3\.?\s*‡∏ñ‡πâ‡∏≤‡∏Å‡∏¥‡∏ô', r'4\.?\s*‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£', r'5\.1\.?\s*‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á',
            r'5\.2\.?\s*‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà', r'6\.?\s*‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö', r'7\.?\s*‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞',
            r'1\.\s*‡∏¢‡∏≤‡∏ô‡∏µ‡πâ', r'2\.\s*‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£', r'3\.\s*‡∏ß‡∏¥‡∏ò‡∏µ', r'4\.\s*‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£',
            r'5\.\s*‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢', r'6\.\s*‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö', r'7\.\s*‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞'
        ]
        
        for pattern in section_headers:
            match = re.search(pattern, content, re.IGNORECASE)
            if match:
                content = content[:match.start()].strip()
                break
        
        return content
    
    def extract_bullet_points_only(self, content: str) -> str:
        """‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ ‚Ä¢ ‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏≠‡∏∑‡πà‡∏ô‡πÜ"""
        if not content:
            return ""
        
        lines = content.split('\n')
        extracted_lines = []
        
        for line in lines:
            line = line.strip()
            if not line:
                continue
                
            # ‡∏´‡∏≤‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ ‚Ä¢
            if line.startswith('‚Ä¢'):
                extracted_lines.append(line)
            # ‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏≤‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ ‚Ä¢ ‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
            elif '‚Ä¢' in line:
                # ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ ‚Ä¢ ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤
                parts = line.split('‚Ä¢')
                for i, part in enumerate(parts):
                    if i > 0:  # ‡∏Ç‡πâ‡∏≤‡∏° part ‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô ‚Ä¢
                        cleaned_part = part.strip()
                        if cleaned_part:
                            extracted_lines.append('‚Ä¢ ' + cleaned_part)
            # ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠
            elif (len(line) > 3 and 
                  not re.match(r'^\d+\.', line) and  # ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏•‡∏Ç‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠
                  not re.match(r'^[^\w]*$', line) and  # ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏•‡πâ‡∏ß‡∏ô
                  not re.match(r'^(‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï|‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤|‡∏ú‡∏π‡πâ‡πÅ‡∏ó‡∏ô‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢|‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ|‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤)', line)):  # ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤
                extracted_lines.append(line)
        
        return ' '.join(extracted_lines) if extracted_lines else content
    
    def clean_section_1_2_content(self, content: str) -> str:
        """‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏™‡πà‡∏ß‡∏ô 1.2 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ 2. ‡∏≠‡∏≠‡∏Å"""
        patterns_to_remove = [
            r'2\.?\s*‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏π‡πâ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏¢‡∏≤.*',
            r'2\.\d+.*'
        ]
        
        for pattern in patterns_to_remove:
            content = re.sub(pattern, '', content, flags=re.IGNORECASE | re.DOTALL)
        
        content = re.sub(r'\s+', ' ', content).strip()
        return content
    
    def extract_medicine_info(self, text: str, pdf_path: str = '') -> Dict:
        """‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°"""
        logger.info("=== ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤ ===")
        
        medicine_info = {
            'name': '',
            'category': '',
            'section_1_1_name': '',
            'section_1_2_purpose': '',
            'section_2_1_contraindications': '',
            'section_2_2_warnings': '',
            'section_3_1_dosage': '',
            'section_3_2_missed_dose': '',
            'section_3_3_overdose': '',
            'section_4_precautions': '',
            'section_5_1_severe_effects': '',
            'section_5_2_mild_effects': '',
            'section_6_storage': '',
            'section_7_appearance_ingredients': ''
        }
        
        print("\n" + "="*80)
        print("üìã ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤")
        print("="*80)
        
        boundaries = self.find_section_boundaries(text)
        
        sections = {
            '1.1': ('section_1_1_name', '1.1 ‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£'),
            '1.2': ('section_1_2_purpose', '1.2 ‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏£'),
            '2.1': ('section_2_1_contraindications', '2.1 ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏£'),
            '2.2': ('section_2_2_warnings', '2.2 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á'),
            '3.1': ('section_3_1_dosage', '3.1 ‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ'),
            '3.2': ('section_3_2_missed_dose', '3.2 ‡∏ñ‡πâ‡∏≤‡∏•‡∏∑‡∏°‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤'),
            '3.3': ('section_3_3_overdose', '3.3 ‡∏ñ‡πâ‡∏≤‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô'),
            '4.': ('section_4_precautions', '4. ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥'),
            '5.1': ('section_5_1_severe_effects', '5.1 ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á'),
            '5.2': ('section_5_2_mild_effects', '5.2 ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á'),
            '6.': ('section_6_storage', '6. ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏Å‡πá‡∏ö‡∏¢‡∏≤'),
            '7.': ('section_7_appearance_ingredients', '7. ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö')
        }
        
        current_main_section = ""
        sections_found = 0
        
        for section_num, (key, title) in sections.items():
            if section_num.startswith('1.') and current_main_section != "1":
                current_main_section = "1"
                print(f"\n1. **‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏¢‡∏≤‡∏≠‡∏∞‡πÑ‡∏£**")
            elif section_num.startswith('2.') and current_main_section != "2":
                current_main_section = "2"
                print(f"\n2. **‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏π‡πâ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏¢‡∏≤**")
            elif section_num.startswith('3.') and current_main_section != "3":
                current_main_section = "3"
                print(f"\n3. **‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏¢‡∏≤**")
            elif section_num.startswith('4.') and current_main_section != "4":
                current_main_section = "4"
                print(f"\n4. **‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏ä‡πâ‡∏¢‡∏≤**")
            elif section_num.startswith('5.') and current_main_section != "5":
                current_main_section = "5"
                print(f"\n5. **‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏¢‡∏≤**")
            elif section_num.startswith('6.') and current_main_section != "6":
                current_main_section = "6"
                print(f"\n6. **‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£**")
            elif section_num.startswith('7.') and current_main_section != "7":
                current_main_section = "7"
                print(f"\n7. **‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏¢‡∏≤**")
            
            if section_num in boundaries:
                start_pos, end_pos = boundaries[section_num]
                section_content = self.extract_section_content(text, start_pos, end_pos)
                
                # ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô 1.2
                if section_num == '1.2':
                    section_content = self.clean_section_1_2_content(section_content)
                
                # ‡πÅ‡∏¢‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ ‚Ä¢ ‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤
                section_content = self.extract_bullet_points_only(section_content)
                
                medicine_info[key] = section_content
                
                print(f"   {title}")
                if section_content:
                    lines = section_content.split('\n')
                    for line in lines:
                        line = line.strip()
                        if line and len(line) > 2:
                            print(f"       ‚Ä¢ {line}")
                    sections_found += 1
                else:
                    print(f"       ‚Ä¢ ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•")
            else:
                print(f"   {title}")
                print(f"       ‚Ä¢ ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•")
        
        # ‡πÅ‡∏¢‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
        full_text_category_patterns = [
            r'‡∏ä‡∏ô‡∏¥‡∏î([^<\n]*?)(?:\s*‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤|\s*<|$)',  
            r'‡∏ä‡∏ô‡∏¥‡∏î‡∏¢‡∏≤([^<\n]*?)(?:\s*‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤|\s*<|$)'  
        ]
        
        for pattern in full_text_category_patterns:
            match = re.search(pattern, text, re.IGNORECASE)
            if match:
                category = match.group(1).strip()
                # ‡∏•‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ < ‡πÅ‡∏•‡∏∞ > ‡∏≠‡∏≠‡∏Å (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                category = category.replace('<', '').replace('>', '').replace('[', '').replace(']', '').strip()
                # ‡∏•‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏à‡∏∏‡∏•‡∏†‡∏≤‡∏Ñ‡∏ó‡πâ‡∏≤‡∏¢ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                category = re.sub(r',\s*$', '', category).strip()
                medicine_info['category'] = category
                logger.info(f"‡∏û‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏¢‡∏≤‡∏à‡∏≤‡∏Å '‡∏ä‡∏ô‡∏¥‡∏î': {medicine_info['category']}")
                break
        
        # ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö)
        if not medicine_info['category']:
            end_category_patterns = [
                r'‡∏ä‡∏ô‡∏¥‡∏î([^<\n]*?)(?=\n\s*‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏¢‡∏¢‡πà‡∏≠|\n\s*‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤|\n\s*$)',  # ‡∏ä‡∏ô‡∏¥‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
                r'‡∏ä‡∏ô‡∏¥‡∏î‡∏¢‡∏≤([^<\n]*?)(?=\n\s*‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏¢‡∏¢‡πà‡∏≠|\n\s*‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤|\n\s*$)',  # ‡∏ä‡∏ô‡∏¥‡∏î‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
            ]
            
            for pattern in end_category_patterns:
                match = re.search(pattern, text, re.IGNORECASE)
                if match:
                    category = match.group(1).strip()
                    # ‡∏•‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ < ‡πÅ‡∏•‡∏∞ > ‡∏≠‡∏≠‡∏Å (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                    category = category.replace('<', '').replace('>', '').replace('[', '').replace(']', '').strip()
                    # ‡∏•‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏à‡∏∏‡∏•‡∏†‡∏≤‡∏Ñ‡∏ó‡πâ‡∏≤‡∏¢ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                    category = re.sub(r',\s*$', '', category).strip()
                    medicine_info['category'] = category
                    logger.info(f"‡∏û‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏¢‡∏≤‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£: {medicine_info['category']}")
                    break
        
        # ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏à‡∏≤‡∏Å section 1.1
        if medicine_info['section_1_1_name']:
            name_patterns = [
                r'‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤\s*([^\n‚Ä¢]+)',
                r'‡∏¢‡∏≤‡∏ô‡∏µ‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤\s*([^\n‚Ä¢]+)',
                r'‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤\s*([^\n‚Ä¢]+)'
            ]
            
            for pattern in name_patterns:
                match = re.search(pattern, medicine_info['section_1_1_name'], re.IGNORECASE)
                if match:
                    medicine_info['name'] = match.group(1).strip()
                    break
        
        # ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏à‡∏≤‡∏Å section 1.1)
        if not medicine_info['name']:
            # ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô "‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏¢‡∏¢‡πà‡∏≠")
            end_document_patterns = [
                r'([^<\n]*?)\s*‡∏Ç‡∏ô‡∏≤‡∏î\s*\d+\s*‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏Å‡∏£‡∏±‡∏°\s*‡∏ä‡∏ô‡∏¥‡∏î[^\n]*?(?=\n\s*‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏¢‡∏¢‡πà‡∏≠|\n\s*‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤|\n\s*$)',  # ‡πÄ‡∏ä‡πà‡∏ô "‡∏û‡∏≤‡∏£‡∏≤‡πÄ‡∏ã‡∏ï‡∏≤‡∏°‡∏≠‡∏• ‡∏Ç‡∏ô‡∏≤‡∏î 500 ‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏Å‡∏£‡∏±‡∏° ‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î"
                r'([^<\n]*?)\s*‡∏Ç‡∏ô‡∏≤‡∏î\s*\d+\s*‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏Å‡∏£‡∏±‡∏°(?=\n\s*‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏¢‡∏¢‡πà‡∏≠|\n\s*‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤|\n\s*$)',  # ‡πÄ‡∏ä‡πà‡∏ô "‡∏û‡∏≤‡∏£‡∏≤‡πÄ‡∏ã‡∏ï‡∏≤‡∏°‡∏≠‡∏• ‡∏Ç‡∏ô‡∏≤‡∏î 500 ‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏Å‡∏£‡∏±‡∏°"
                r'([^<\n]*?)\s*‡∏ä‡∏ô‡∏¥‡∏î[^\n]*?(?=\n\s*‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏¢‡∏¢‡πà‡∏≠|\n\s*‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤|\n\s*$)',  # ‡πÄ‡∏ä‡πà‡∏ô "‡∏û‡∏≤‡∏£‡∏≤‡πÄ‡∏ã‡∏ï‡∏≤‡∏°‡∏≠‡∏• ‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î"
                r'([^<\n]*?)\s*‡∏Ç‡∏ô‡∏≤‡∏î\s*\d+\s*‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏Å‡∏£‡∏±‡∏°\s*‡∏ä‡∏ô‡∏¥‡∏î[^\n]*?(?=\n\s*$)',  # ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
                r'([^<\n]*?)\s*‡∏Ç‡∏ô‡∏≤‡∏î\s*\d+\s*‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏Å‡∏£‡∏±‡∏°(?=\n\s*$)',  # ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
            ]
            
            for pattern in end_document_patterns:
                match = re.search(pattern, text, re.IGNORECASE)
                if match:
                    potential_name = match.group(1).strip()
                    # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤
                    if (len(potential_name) > 2 and 
                        not re.search(r'^\d+\.', potential_name) and  # ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏•‡∏Ç‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠
                        not re.search(r'^[^\w]*$', potential_name) and  # ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏•‡πâ‡∏ß‡∏ô
                        not re.search(r'^(‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï|‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤|‡∏ú‡∏π‡πâ‡πÅ‡∏ó‡∏ô‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢|‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ)', potential_name)):  # ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤
                        medicine_info['name'] = potential_name
                        logger.info(f"‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£: {medicine_info['name']}")
                        break
        
        # ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö)
        if not medicine_info['name']:
            # ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
            top_document_patterns = [
                r'([^<\n]*?)\s*‡∏Ç‡∏ô‡∏≤‡∏î\s*\d+\s*‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏Å‡∏£‡∏±‡∏°\s*‡∏ä‡∏ô‡∏¥‡∏î[^\n]*?(?=\n\s*‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô|\n\s*1\.|\n\s*$)',  # ‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                r'([^<\n]*?)\s*‡∏Ç‡∏ô‡∏≤‡∏î\s*\d+\s*‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏Å‡∏£‡∏±‡∏°(?=\n\s*‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô|\n\s*1\.|\n\s*$)',  # ‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            ]
            
            for pattern in top_document_patterns:
                match = re.search(pattern, text, re.IGNORECASE)
                if match:
                    potential_name = match.group(1).strip()
                    # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤
                    if (len(potential_name) > 2 and 
                        not re.search(r'^\d+\.', potential_name) and  # ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏•‡∏Ç‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠
                        not re.search(r'^[^\w]*$', potential_name) and  # ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏•‡πâ‡∏ß‡∏ô
                        not re.search(r'^(‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï|‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤|‡∏ú‡∏π‡πâ‡πÅ‡∏ó‡∏ô‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢|‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ)', potential_name)):  # ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤
                        medicine_info['name'] = potential_name
                        logger.info(f"‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£: {medicine_info['name']}")
                        break
        
        # ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö)
        if not medicine_info['name'] and pdf_path:
            filename = Path(pdf_path).stem
            if filename:
                # ‡∏•‡∏ö‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå
                cleaned_filename = re.sub(r'[_\-\s]+', ' ', filename)
                cleaned_filename = re.sub(r'extracted|text|media|\(\d+\)', '', cleaned_filename, flags=re.IGNORECASE)
                cleaned_filename = cleaned_filename.strip()
                
                if len(cleaned_filename) > 2:
                    medicine_info['name'] = cleaned_filename
                    logger.info(f"‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå: {medicine_info['name']}")
        
        return medicine_info
    
    def convert_to_json(self, medicine_info: Dict) -> str:
        """‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô JSON"""
        try:
            return json.dumps(medicine_info, ensure_ascii=False, indent=2)
        except Exception as e:
            logger.error(f"‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô JSON: {e}")
            return ""
    
    def process_pdf(self, pdf_path: str) -> Dict:
        """‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÑ‡∏ü‡∏•‡πå PDF ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"""
        logger.info(f"‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÑ‡∏ü‡∏•‡πå: {pdf_path}")
        
        text = self.extract_text_from_pdf(pdf_path)
        if not text:
            return {}
        
        cleaned_text = self.clean_text(text)
        medicine_info = self.extract_medicine_info(cleaned_text, pdf_path)
        
        return medicine_info